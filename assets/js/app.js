(()=>{let e={PLAYER:{INIT:"player.init",UPDATE:"player.update",OTHER_UPDATE:"player.other_update"},ROOM:{INIT:"room.init",UPDATE:"room.update",OTHER_UPDATE:"room.other_update",GET_ROOMS:"room.get_rooms",GET_PLAYERS:"room.get_players",ADD:"room.add",REMOVE:"room.remove",ENTER:"room.enter",LEAVE:"room.leave",KICK:"room.kick",GAME:{INIT:"room.game.init",UPDATE:"room.game.update",SIT:"room.game.sit",STAND:"room.game.stand",READY:"room.game.ready",START:"room.game.start",END:"room.game.end",MOVE:"room.game.move"}},TOKEN:"token",ERROR:"error",OTHER_CONNECT:"other_connect"},t,o={id:"a",name:"b",room_id:"c",is_master:"d",online:"e"},n={id:"a",type:"b",n_players:"c"};debug=!1,e={PLAYER:{INIT:"v",UPDATE:"a",OTHER_UPDATE:"b"},ROOM:{INIT:"o",UPDATE:"c",OTHER_UPDATE:"d",GET_ROOMS:"e",GET_PLAYERS:"f",ADD:"g",REMOVE:"h",ENTER:"t",LEAVE:"w",KICK:"k",GAME:{INIT:"gi",UPDATE:"gu",SIT:"gc",STAND:"gd",READY:"gr",START:"gs",END:"ge",MOVE:"gm"}},TOKEN:"l",ERROR:"m",OTHER_CONNECT:"n"};let r=["H\xe0 Nội","Hồ Ch\xed Minh","An Giang","T\xe2y Ninh","S\xf3c Trăng","Nha Trang","Huế","Đ\xe0 Nẵng","Bắc Giang","Th\xe1i Nguy\xean","Quảng Ninh","B\xe0 Rịa - Vũng T\xe0u",],i={AUTH:1,MAIN:2,ROOM:3,GAME:4},a={VERSION:"1.0.0",HOTLINE:"19008198"},s={username:"T\xe0i khoản",password:"Mật khẩu",login:"Đăng nhập",register:"Đăng k\xfd",re_password:"Nhập lại mật khẩu",username_holder:"Nhập username...",password_holder:"Nhập password...",re_password_holder:"Nhập lại password..."},u=function(){let e="token",t={};function o(t){localStorage.setItem(e,t)}function n(){localStorage.removeItem(e)}return Object.defineProperties(t,{token:{get:function(){return localStorage.getItem(e)}},add:{get:function(){return o}},remove:{get:function(){return n}}}),t}();function l(e){let t={};for(let o in e)t[e[o]]=o;return t}function m(e,t){return e=e.split(","),t=l(t),{id:e[0],attr:t[e[1]]||e[1],value:e[2]}}function d(e,t=toPlayer){let o={};for(let n in e){let r=t(e[n]);o[r.id]=r}return o}function E(e,t,r=atob("aHR0cDovL2xvY2FsaG9zdDozMDAw"),i,a){i=i||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwiaWF0IjoxNTE2MjM5MDIyfQ.ziwsU2urwe6CpQDDCuLKZuWmay7xQA0Ds8Fk7EC2_qM";let s=O(r=atob("d3M6Ly8xMDMuOTcuMTI0LjE5Mjo4MA=="),i,e,void 0,function(e){t.reset(e),u.remove()});return new c(e,s,t),s[e.ERROR]=a,s[e.TOKEN]=u.add,s[e.PLAYER.INIT]=e=>{let o=toPlayer(e);t.me=o},s[e.PLAYER.UPDATE]=e=>{let{id:n,attr:r,value:i}=m(e,o),a=t.me;a[r]=i,t.me=a},s[e.PLAYER.OTHER_UPDATE]=e=>{let{id:n,attr:r,value:i}=m(e,o),a=t.players;a[n][r]=i,t.players=null,t.players=a},s[e.ROOM.INIT]=e=>{let o=toRoom(e);t.room=o},s[e.ROOM.UPDATE]=e=>{let o=toRoom(e);t.room=o,t.me.room_id=o.id,t.screen=o.type},s[e.ROOM.OTHER_UPDATE]=e=>{let{id:o,attr:r,value:i}=m(e,n),a=t.rooms;a[o][r]=i,t.rooms=null,t.rooms=a},s[e.ROOM.GET_PLAYERS]=e=>{t.players=d(e,toPlayer)},s[e.ROOM.GET_ROOMS]=e=>{t.rooms=d(e,toRoom)},s[e.ROOM.ENTER]=e=>{let o=toPlayer(e),n=o.id,r=t.players;r[n]=o,t.players=null,t.players=r},s[e.ROOM.LEAVE]=e=>{let o=t.players;delete o[e],t.players=null,t.players=o},s[e.ROOM.ADD]=e=>{let o=toRoom(e),n=o.id,r=t.rooms;r[n]=o,t.rooms=null,t.rooms=r},s[e.ROOM.REMOVE]=e=>{let o=t.rooms;delete o[e],t.rooms=null,t.rooms=o},s[e.OTHER_CONNECT]=e=>{t.reset("Đăng nhập từ thiết bị kh\xe1c!")},s}function c(e,t,o){let n;t[e.ROOM.GAME.INIT]=e=>{var t;let{info:r,fen:s}=e,u=toGame(r);o.game=u,(i=Xiangqiboard("board1",t=s)).orientation("b"==o.me.turn?"black":"red"),a=new Xiangqi(t),$(".square-2b8ce").click(E),n=Modal("modal-2"),"0"!=u.status&&n.start.show()},t[e.ROOM.GAME.UPDATE]=e=>{let{attr:t,value:n}=m(e);o.game[t]=n},t[e.ROOM.GAME.MOVE]=e=>{var t,o;let{from:n,to:u}=e;t=n,o=u,i.move(`${t}-${o}`),a.move(`${t}${o}`),l&&l.classList.remove(r),d&&d.classList.remove(r),l=$(`.square-${t}`)[0],d=$(`.square-${o}`)[0],l.classList.add(r),d.classList.add(r),s=null},t[e.ROOM.GAME.END]=e=>{n[`end-${e||0}`].show()};let r="selected",i,a,s,u,l,d;function E(){if(!o.game.status||a.turn()!=o.me.turn)return;let n=event.target,i=$(this).data("square"),l;if((piece=$(n).data("piece"))&&(l=piece[0]),o.me.turn==l)u&&u.classList.remove(r),this.classList.add(r),s=i,u=this;else if(s){var m,d;m=s,d=i,a.move(`${m}${d}`)&&t[e.ROOM.GAME.MOVE]({from:m,to:d})}}}function O(e,t,o,n=120,r=Function()){let i=new io(e,{transports:["websocket"],auth:{token:t}}),a={disconnect:function e(){i.disconnect()},beforeEmit:function e(){},afterEmit:function e(){},afterListen:function e(){},connect_error:r},s={},u;function l(e,t){if(a.beforeEmit(),u){s.error("too fast!"),a.afterListen(e,t);return}i.emit(e,t),u=!0,setTimeout(function(){u=!1,a.afterEmit(e,t)},n)}function m(e,t){s[e]=t}return i.on("connect_error",r),!function e(t){for(let o in t){let n=t[o];if("object"==typeof n){e(n);continue}Object.defineProperty(a,n,{get:function(){return e=>l(n,e)},set:function(e){var t,o;t=n,o=e,s[t]=o}}),i.on(n,function(e){"function"==typeof s[n]&&s[n](e),a.afterListen(n,e)})}}(o),a._disconnect=function(){i.disconnect()},a}toPlayer=toRoom=toGame=function(e){return e},debug||(toPlayer=function(e){return{id:(e=e.split(","))[0],is_master:e[1],ready:e[2],turn:e[3],online:e[4],name:e[5],room_id:e[6]}},toRoom=function(e){return{id:(e=e.split(","))[0],type:e[1],n_players:e[2]}},toGame=function(e){return{id:(e=e.split(","))[0],p0:e[1],p1:e[2],status:e[3],turn:e[4]}});let p,f=new Modal,T,R=new _FormValidate(void 0,{messages:{between:`Dữ liệu từ 6 đến 24 k\xfd tự`,required:"Kh\xf4ng được bỏ trống",same:"Mật khẩu kh\xf4ng tr\xf9ng khớp"}},A),g=new Vue({el:"#app",data:{APP:a,SCREEN:i,LANG:s,ROOMS:r,layout:{tabs_auth:!0,popup_msg:""},me:{},room:{},game:{},players:[],rooms:[],screen:u.token?0:i.AUTH},methods:{login(e){R.add(e.target),e.target.onsubmit(e),e.preventDefault()},guest(e){M()},reset:function(e){this.me={},this.room={},this.players={},this.rooms={},this.screen=i.AUTH,p.disconnect(),p=void 0,f.loading.hide(),e&&f.popup.show(e)},roomAdd(t){p[e.ROOM.ADD]()},roomEnter(t){p[e.ROOM.ENTER](t)},roomLeave(t){p[e.ROOM.LEAVE]()},roomKick(t){p[e.ROOM.KICK](t)},roomSit:function(t){let o=`p${t}`,n=this.game[o],r=this.me.id+"",i=[this.game.p0+"",this.game.p1+""];n&&0!=n||i.includes(r)||p[e.ROOM.GAME.SIT](t)},roomStand(t){p[e.ROOM.GAME.STAND](t)},gameReady(t){p[e.ROOM.GAME.READY]()}}});function M(t){p||(f.loading.show(),p=E(e,g,void 0,t,e=>{f.tooltip.show(e)}),u.add(t),p.beforeEmit=f.loading.show,p.afterListen=f.loading.hide)}function h(e){let{code:t,msg:o,data:n}=JSON.parse(e);u.remove(),t?f.popup.show(o):M(n)}function A(e,t){if(t.preventDefault(),T)return;let o=e.elements,n=o.username.value,r=o.password.value,i=o.re_password?o.re_password.value:"",a={success(e){f.loading.hide(),T=!1,h(e)},error:function(){f.popup.show("Request error!"),f.loading.hide()},beforeSend:function(){f.loading.show(),T=!0},afterSend:function(){}},s=atob("aHR0cDovL2h1eS1hcGkub25saW5lL3B1YmxpYy9hcGkvdjEv");e.id.includes("login")?ajax(s+"login","POST",{username:n,password:r},a):ajax(s+"register","POST",{username:n,password:r,re_password:i},a)}(token=u.token)?h(JSON.stringify({code:0,data:token})):f.loading.hide()})();
